{% extends 'base2.html' %}  
{% block content %}
{% load staticfiles %}
{% load static %}

    <script type="text/javascript" src="{% static "ckeditor/ckeditor-init.js" %}"></script>
    <script type="text/javascript" src="{% static "ckeditor/ckeditor/ckeditor.js" %}"></script>
    
<style> 
div{text-align:center} 
</style>
{% for i in classnotesdetail %}
 <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-8 col-md-9 col-lg-10">
                <div class="panel panel-default">
                    <div class="panel-heading"><h2>{{ i.notename }}</h2></div>
                    <div class="panel-body">
                     <p>发表日期：{{i.notetime}}
                     &nbsp;&nbsp;
                  <span class="glyphicon glyphicon-eye-open"></span>&nbsp;阅读({{ i.readed_num }})</p>
                     <p>{{ i.notecontent|safe}}</p>
                     {% endfor %}

        </div>
    </div>
     </div>
    </div>


<style> 
a{text-align:left} 
</style>
<style> 
h3{text-align:left} 
</style>
<style> 
li{text-align:left} 
</style>
&nbsp;&nbsp;&nbsp;&nbsp;<a>{{ user }}，欢迎评论~</a>
<div class="row">
            <div class="col-xs-10 col-xs-offset-1">
                <div class="comment-area">
                    
                   
                        <form id='comment_form' onsubmit="return false" action="{% url 'update_comment' %}" method="POST" style="overflow:hidden">
                            {% csrf_token %}
                            <div class="form-group">
                                
                                <textarea id="comment_text" class="form-control" name="text" rows="4"></textarea>    
                            </div>
                            <input type="hidden" name="notes_pk" value="{{i.pk }}">
                            
                            <input type="hidden" name="object_id" value="{{ notename_pk }}">
                            <input type="hidden" name="content_type" value="classnotes">
                            <span id="comment_error" class="text-danger pull-left"></span>
                            <input type="submit" value="评论" class="btn btn-primary" style="float:right">
                            
                        </form>
                   
                </div>
                <div class="comment-area">
                    <h3 class="comment-area-title">评论列表</h3>
                    <ul id="comment_list">
                    {% for comment in comments %}
                        <li>
                            {{ comment.user}}
                            ({{ comment.comment_time}})：
                            {{ comment.text }}
                        </li>
                    {% empty %}
                        暂无评论
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div> 

<script type="text/javascript">
        $("#comment_form").submit(function(){
           
            // 异步提交
            $.ajax({
                url: "{% url 'update_comment' %}",
                type: 'POST',
                data: $(this).serialize(),
                cache: false,
                success: function(data){
                    console.log(data);
                    if(data['status']=="SUCCESS"){
                        // 插入数据
                        var comment_html = '<li>' + data['user'] + 
                                           ' (' + data['comment_time'] + ')：' + 
                                           data['text'] + '</li>';
                        $("#comment_list").prepend(comment_html);
                        // 清空编辑框的内容
                        CKEDITOR.instances['id_text'].setData('');
                    }else{
                        // 显示错误信息
                        $("#comment_error").text(data['message']);
                    }                    
                },
                error: function(xhr){
                    console.log(xhr);
                }
            });
            return false;
        });
    </script>

{% endblock %}

